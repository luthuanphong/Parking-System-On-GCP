---
config:
  theme: forest
---
flowchart LR
    %% Actors and Start
    A([Start]) --> B[User enters login credentials]
    B --> C[Validate credentials via Authentication Service]
    C --> D{Login successful?}
    D -->|No| Z1[Show error message to User] --> A
    D -->|Yes| E[Redirect to Booking Page]

    %% Booking request
    E --> F[User requests parking booking]
    F --> G[Send booking request to Booking Service]
    G --> H[Retrieve user info from Cache Redis]
    H --> I[Check user balance]

    %% Balance check
    I --> J{Sufficient balance?}
    J -->|No| K[Show error: Insufficient balance] --> A
    J -->|Yes| L[Get parking spot data from Cache]

    %% Availability check
    L --> M[Check parking availability]
    M --> N{Spot available?}
    N -->|No| O[Show error: Spot unavailable] --> A
    N -->|Yes| P[Insert reservation record<br/>Update parking spot status<br/>Deduct user balance in DB]

    %% Success flow
    P --> Q[Confirmation success from DB]
    Q --> R[Show booking confirmation to User]
    R --> S([End])
